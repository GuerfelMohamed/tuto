<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Saving favorite pictures</title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/js/client.js"></script></head><body class="tuto 5.0 pictures"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href="/" class="ocsimore_phrasing_link"><img src="/img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Doc
</p><ul class="mainmenu"><li class="mainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="mainmenu-doc mainmenu-current"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li><a href="/lwt/3.3.0/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li><a href="/tyxml/4.1.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li></ul><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc drawermainmenu-current"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href="/ocsigenserver/2.9/manual/quickstart" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href="/lwt/3.3.0/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href="/tyxml/4.1.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href="/ocsigen-toolkit/1.1.0/manual/intro" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-page"><a href="/projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href="/papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href="/credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href="/blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1> Main tutorial</h1><h2><a href="/tuto/5.0/manual/intro" class="ocsimore_phrasing_link">Introduction. Ocsigen: where to start?</a></h2><h2><a href="/tuto/5.0/manual/basicwebsite" class="ocsimore_phrasing_link">A basic Web site in OCaml</a></h2><h2><a href="/tuto/5.0/manual/tutowidgets" class="ocsimore_phrasing_link">Eliom apps basics: writing client-server widgets</a></h2><h2><a href="/tuto/5.0/manual/application" class="ocsimore_phrasing_link">Client/server application: Graffiti</a></h2><h2><a href="/tuto/5.0/manual/how-to-register-session-data" class="ocsimore_phrasing_link">Session data: Eliom references</a></h2><h2><a href="/tuto/5.0/manual/interaction" class="ocsimore_phrasing_link">Service based Web programming</a></h2><h2><a href="/tuto/5.0/manual/tutoreact" class="ocsimore_phrasing_link">Reactive client-server Web applications</a></h2><h2><a href="/tuto/5.0/manual/misc" class="ocsimore_phrasing_link">Mixing traditional Web interaction with client-server app</a></h2><h1> 5-minute tutorials</h1><h2><a href="/tuto/5.0/manual/lwt" class="ocsimore_phrasing_link">Lwt</a></h2><h2><a href="/tuto/5.0/manual/html" class="ocsimore_phrasing_link">HTML</a></h2><h1> Other tutorials: Miscellanous features</h1><h2><a href="/tuto/5.0/manual/custom-conf" class="ocsimore_phrasing_link">Custom configuration</a></h2><h2><a href="/tuto/5.0/manual/rest" class="ocsimore_phrasing_link">RESTful JSON API</a></h2><h2><a href="/tuto/5.0/manual/ocsipersist" class="ocsimore_phrasing_link">Persistent tables with Ocsipersist</a></h2><h2><a href="/tuto/5.0/manual/hash-password" class="ocsimore_phrasing_link">Protecting passwords</a></h2><h2><a href="/tuto/5.0/manual/macaque" class="ocsimore_phrasing_link">MaCaQue: SQL queries - Users</a></h2><h1> Improving Graffiti</h1><h2><a href="/tuto/5.0/manual/pictures" class="ocsimore_phrasing_link">Download pictures</a></h2><h2><a href="/tuto/5.0/manual/music" class="ocsimore_phrasing_link">Playing music</a></h2><h2><a href="/tuto/5.0/manual/reactivemediaplayer" class="ocsimore_phrasing_link">Reactive media player</a></h2><h1 class="howto"> HOW-TO</h1><h2> My first steps with Ocsigen</h2><h3><a href="/tuto/5.0/manual/how-to-install-ocsigen" class="ocsimore_phrasing_link">How to install Ocsigen</a></h3><h3><a href="/tuto/5.0/manual/how-to-make-hello-world-in-ocsigen" class="ocsimore_phrasing_link">How to make &quot;hello world&quot; in Ocsigen</a></h3><h3><a href="/tuto/5.0/manual/how-to-compile-my-ocsigen-pages" class="ocsimore_phrasing_link">How to compile my Ocsigen pages</a></h3><h3><a href="/tuto/5.0/manual/how-to-configure-and-launch-the-ocsigen-server" class="ocsimore_phrasing_link">How to configure and launch the Ocsigen Server</a></h3><h3><a href="/tuto/5.0/manual/how-does-a-page-s-source-code-look" class="ocsimore_phrasing_link">How does a client-server app source code look like?</a></h3><h2> How to put some elements in my page ?</h2><h3><a href="/tuto/5.0/manual/how-to-make-page-a-skeleton" class="ocsimore_phrasing_link">How to make a page skeleton</a></h3><h3><a href="/tuto/5.0/manual/how-to-use-get-parameters-or-parameters-in-the-url" class="ocsimore_phrasing_link">How to use GET parameters (parameters in the URL)</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-css-stylesheet" class="ocsimore_phrasing_link">How to add CSS stylesheet</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-javascript-script" class="ocsimore_phrasing_link">How to add a Javascript script</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-div" class="ocsimore_phrasing_link">How to add a div</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-list" class="ocsimore_phrasing_link">How to add lists in pages?</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-an-image" class="ocsimore_phrasing_link">How to add an image</a></h3><h3><a href="/tuto/5.0/manual/how-to-write-titles-and-paragraphs" class="ocsimore_phrasing_link">How to write titles and paragraphs</a></h3><h3><a href="/tuto/5.0/manual/how-to-set-and-id-classes-or-other-attributes-to-html-elements" class="ocsimore_phrasing_link">How to set and id, classes or other attributes to HTML elements</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-select-or-other-form-element" class="ocsimore_phrasing_link">How to add select (or other form element)</a></h3><h3><a href="/tuto/5.0/manual/how-to-insert-raw-form-elements-not-belonging-to-a-form-towards-a-service" class="ocsimore_phrasing_link">How to insert &quot;raw&quot; form elements (not belonging to a form towards a service)</a></h3><h3><a href="/tuto/5.0/manual/how-to-make-responsive-css" class="ocsimore_phrasing_link">How to make responsive CSS</a></h3><h2> Services</h2><h3><a href="/tuto/5.0/manual/how-to-do-links-to-other-pages" class="ocsimore_phrasing_link">How to do links to other pages</a></h3><h3><a href="/tuto/5.0/manual/how-to-write-forms" class="ocsimore_phrasing_link">How to write forms</a></h3><h3><a href="/tuto/5.0/manual/how-to-register-a-service-that-decides-itself-what-to-send" class="ocsimore_phrasing_link">How to register a service that decides itself what to send</a></h3><h3><a href="/tuto/5.0/manual/how-to-create-link-to-a-current-page-without-knowing-its-url" class="ocsimore_phrasing_link">How to create link to a current page (without knowing its URL)</a></h3><h3><a href="/tuto/5.0/manual/how-to-create-form-wizard-sequence-of-pages-depending-on-data-entered-on-previous-ones" class="ocsimore_phrasing_link">How to create form wizard (sequence of pages depending on data entered on previous ones)</a></h3><h3><a href="/tuto/5.0/manual/how-to-write-a-json-service" class="ocsimore_phrasing_link">How to write a JSON service</a></h3><h3><a href="/tuto/5.0/manual/how-to-send-file-download" class="ocsimore_phrasing_link">How to send a file (download)</a></h3><h3><a href="/tuto/5.0/manual/how-to-send-file-upload" class="ocsimore_phrasing_link">How to send a file (upload)</a></h3><h2> Js_of_ocaml</h2><h3><a href="/tuto/5.0/manual/how-to-attach-ocaml-values-to-dom-elements" class="ocsimore_phrasing_link">How to attach OCaml values to DOM elements</a></h3><h3><a href="/tuto/5.0/manual/how-to-know-whether-the-browser-window-has-the-focus-or-not" class="ocsimore_phrasing_link">How to know whether the browser window has the focus or not</a></h3><h3><a href="/tuto/5.0/manual/how-to-build-js-object" class="ocsimore_phrasing_link">How to build js object</a></h3><h3><a href="/tuto/5.0/manual/how-to-stop-default-behaviour-of-events" class="ocsimore_phrasing_link">How to stop default behaviour of events</a></h3><h3><a href="/tuto/5.0/manual/how-to-call-an-ocaml-function-from-js-code" class="ocsimore_phrasing_link">How to call an OCaml function from js code</a></h3><h2> Eliom client-server applications</h2><h3><a href="/tuto/5.0/manual/how-to-call-a-server-side-function-from-client-side" class="ocsimore_phrasing_link">How to call a server-side function from the client side</a></h3><h3><a href="/tuto/5.0/manual/how-to-make-the-client-side-program-get-an-html-element-from-the-server-and-insert-it-in-the-page" class="ocsimore_phrasing_link">How to make the client side program get an HTML element from the server and insert it in the page</a></h3><h3><a href="/tuto/5.0/manual/how-to-attach-ocaml-values-to-the-html-nodes-sent-to-the-client" class="ocsimore_phrasing_link">How to attach OCaml values to the HTML nodes sent to the client</a></h3><h3><a href="/tuto/5.0/manual/how-to-iterate-on-all-sessions-for-one-user-or-all-tabs" class="ocsimore_phrasing_link">How to iterate on all sessions for one user, or all tabs</a></h3><h3><a href="/tuto/5.0/manual/how-to-implement-a-notification-system" class="ocsimore_phrasing_link">How to implement a notification system</a></h3><h3><a href="/tuto/5.0/manual/how-to-send-a-file-to-server-without-stopping-the-client-process" class="ocsimore_phrasing_link">How to send a file to server without stopping the client process</a></h3><h3><a href="/tuto/5.0/manual/how-to-detect-channel-disconnection" class="ocsimore_phrasing_link">How to detect channel disconnection</a></h3><h3><a href="/tuto/5.0/manual/how-to-detect-on-client-side-that-the-server-side-state-for-the-process-is-closed" class="ocsimore_phrasing_link">How to detect on client side that the server side state for the process is closed</a></h3><h2> Database</h2><h3><a href="/tuto/5.0/manual/how-to-use-a-database-with-eliom" class="ocsimore_phrasing_link">How to use a database with Eliom</a></h3><h2> Eliom Server side</h2><h3><a href="/tuto/5.0/manual/how-do-i-create-a-cryptographically-safe-identifier" class="ocsimore_phrasing_link">How do I create a Cryptographically safe identifier</a></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value="/tuto/dev/manual/pictures">dev</option><option value="/tuto/6.2/manual/pictures">6.2</option><option value="/tuto/6.1/manual/pictures">6.1</option><option value="/tuto/6.0/manual/pictures">6.0</option><option selected="selected">5.0</option><option value="/tuto/4.2/manual/pictures">4.2</option><option value="/tuto/4.1/manual/pictures">4.1</option><option value="/tuto/4.0/manual/pictures">4.0</option><option value="/tuto/3.0/manual/pictures">3.0</option><option value="/tuto/2.2/manual/pictures">2.2</option><option value="/tuto/2.0/manual/pictures">2.0</option></select><form id="search"><input name="q" id="q" placeholder="search ..."/><button>Search</button></form><nav class="how-doctree"><h1> Main tutorial</h1><h2><a href="/tuto/5.0/manual/intro" class="ocsimore_phrasing_link">Introduction. Ocsigen: where to start?</a></h2><h2><a href="/tuto/5.0/manual/basicwebsite" class="ocsimore_phrasing_link">A basic Web site in OCaml</a></h2><h2><a href="/tuto/5.0/manual/tutowidgets" class="ocsimore_phrasing_link">Eliom apps basics: writing client-server widgets</a></h2><h2><a href="/tuto/5.0/manual/application" class="ocsimore_phrasing_link">Client/server application: Graffiti</a></h2><h2><a href="/tuto/5.0/manual/how-to-register-session-data" class="ocsimore_phrasing_link">Session data: Eliom references</a></h2><h2><a href="/tuto/5.0/manual/interaction" class="ocsimore_phrasing_link">Service based Web programming</a></h2><h2><a href="/tuto/5.0/manual/tutoreact" class="ocsimore_phrasing_link">Reactive client-server Web applications</a></h2><h2><a href="/tuto/5.0/manual/misc" class="ocsimore_phrasing_link">Mixing traditional Web interaction with client-server app</a></h2><h1> 5-minute tutorials</h1><h2><a href="/tuto/5.0/manual/lwt" class="ocsimore_phrasing_link">Lwt</a></h2><h2><a href="/tuto/5.0/manual/html" class="ocsimore_phrasing_link">HTML</a></h2><h1> Other tutorials: Miscellanous features</h1><h2><a href="/tuto/5.0/manual/custom-conf" class="ocsimore_phrasing_link">Custom configuration</a></h2><h2><a href="/tuto/5.0/manual/rest" class="ocsimore_phrasing_link">RESTful JSON API</a></h2><h2><a href="/tuto/5.0/manual/ocsipersist" class="ocsimore_phrasing_link">Persistent tables with Ocsipersist</a></h2><h2><a href="/tuto/5.0/manual/hash-password" class="ocsimore_phrasing_link">Protecting passwords</a></h2><h2><a href="/tuto/5.0/manual/macaque" class="ocsimore_phrasing_link">MaCaQue: SQL queries - Users</a></h2><h1> Improving Graffiti</h1><h2><a href="/tuto/5.0/manual/pictures" class="ocsimore_phrasing_link">Download pictures</a></h2><h2><a href="/tuto/5.0/manual/music" class="ocsimore_phrasing_link">Playing music</a></h2><h2><a href="/tuto/5.0/manual/reactivemediaplayer" class="ocsimore_phrasing_link">Reactive media player</a></h2><h1 class="howto"> HOW-TO</h1><h2> My first steps with Ocsigen</h2><h3><a href="/tuto/5.0/manual/how-to-install-ocsigen" class="ocsimore_phrasing_link">How to install Ocsigen</a></h3><h3><a href="/tuto/5.0/manual/how-to-make-hello-world-in-ocsigen" class="ocsimore_phrasing_link">How to make &quot;hello world&quot; in Ocsigen</a></h3><h3><a href="/tuto/5.0/manual/how-to-compile-my-ocsigen-pages" class="ocsimore_phrasing_link">How to compile my Ocsigen pages</a></h3><h3><a href="/tuto/5.0/manual/how-to-configure-and-launch-the-ocsigen-server" class="ocsimore_phrasing_link">How to configure and launch the Ocsigen Server</a></h3><h3><a href="/tuto/5.0/manual/how-does-a-page-s-source-code-look" class="ocsimore_phrasing_link">How does a client-server app source code look like?</a></h3><h2> How to put some elements in my page ?</h2><h3><a href="/tuto/5.0/manual/how-to-make-page-a-skeleton" class="ocsimore_phrasing_link">How to make a page skeleton</a></h3><h3><a href="/tuto/5.0/manual/how-to-use-get-parameters-or-parameters-in-the-url" class="ocsimore_phrasing_link">How to use GET parameters (parameters in the URL)</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-css-stylesheet" class="ocsimore_phrasing_link">How to add CSS stylesheet</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-javascript-script" class="ocsimore_phrasing_link">How to add a Javascript script</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-div" class="ocsimore_phrasing_link">How to add a div</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-list" class="ocsimore_phrasing_link">How to add lists in pages?</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-an-image" class="ocsimore_phrasing_link">How to add an image</a></h3><h3><a href="/tuto/5.0/manual/how-to-write-titles-and-paragraphs" class="ocsimore_phrasing_link">How to write titles and paragraphs</a></h3><h3><a href="/tuto/5.0/manual/how-to-set-and-id-classes-or-other-attributes-to-html-elements" class="ocsimore_phrasing_link">How to set and id, classes or other attributes to HTML elements</a></h3><h3><a href="/tuto/5.0/manual/how-to-add-a-select-or-other-form-element" class="ocsimore_phrasing_link">How to add select (or other form element)</a></h3><h3><a href="/tuto/5.0/manual/how-to-insert-raw-form-elements-not-belonging-to-a-form-towards-a-service" class="ocsimore_phrasing_link">How to insert &quot;raw&quot; form elements (not belonging to a form towards a service)</a></h3><h3><a href="/tuto/5.0/manual/how-to-make-responsive-css" class="ocsimore_phrasing_link">How to make responsive CSS</a></h3><h2> Services</h2><h3><a href="/tuto/5.0/manual/how-to-do-links-to-other-pages" class="ocsimore_phrasing_link">How to do links to other pages</a></h3><h3><a href="/tuto/5.0/manual/how-to-write-forms" class="ocsimore_phrasing_link">How to write forms</a></h3><h3><a href="/tuto/5.0/manual/how-to-register-a-service-that-decides-itself-what-to-send" class="ocsimore_phrasing_link">How to register a service that decides itself what to send</a></h3><h3><a href="/tuto/5.0/manual/how-to-create-link-to-a-current-page-without-knowing-its-url" class="ocsimore_phrasing_link">How to create link to a current page (without knowing its URL)</a></h3><h3><a href="/tuto/5.0/manual/how-to-create-form-wizard-sequence-of-pages-depending-on-data-entered-on-previous-ones" class="ocsimore_phrasing_link">How to create form wizard (sequence of pages depending on data entered on previous ones)</a></h3><h3><a href="/tuto/5.0/manual/how-to-write-a-json-service" class="ocsimore_phrasing_link">How to write a JSON service</a></h3><h3><a href="/tuto/5.0/manual/how-to-send-file-download" class="ocsimore_phrasing_link">How to send a file (download)</a></h3><h3><a href="/tuto/5.0/manual/how-to-send-file-upload" class="ocsimore_phrasing_link">How to send a file (upload)</a></h3><h2> Js_of_ocaml</h2><h3><a href="/tuto/5.0/manual/how-to-attach-ocaml-values-to-dom-elements" class="ocsimore_phrasing_link">How to attach OCaml values to DOM elements</a></h3><h3><a href="/tuto/5.0/manual/how-to-know-whether-the-browser-window-has-the-focus-or-not" class="ocsimore_phrasing_link">How to know whether the browser window has the focus or not</a></h3><h3><a href="/tuto/5.0/manual/how-to-build-js-object" class="ocsimore_phrasing_link">How to build js object</a></h3><h3><a href="/tuto/5.0/manual/how-to-stop-default-behaviour-of-events" class="ocsimore_phrasing_link">How to stop default behaviour of events</a></h3><h3><a href="/tuto/5.0/manual/how-to-call-an-ocaml-function-from-js-code" class="ocsimore_phrasing_link">How to call an OCaml function from js code</a></h3><h2> Eliom client-server applications</h2><h3><a href="/tuto/5.0/manual/how-to-call-a-server-side-function-from-client-side" class="ocsimore_phrasing_link">How to call a server-side function from the client side</a></h3><h3><a href="/tuto/5.0/manual/how-to-make-the-client-side-program-get-an-html-element-from-the-server-and-insert-it-in-the-page" class="ocsimore_phrasing_link">How to make the client side program get an HTML element from the server and insert it in the page</a></h3><h3><a href="/tuto/5.0/manual/how-to-attach-ocaml-values-to-the-html-nodes-sent-to-the-client" class="ocsimore_phrasing_link">How to attach OCaml values to the HTML nodes sent to the client</a></h3><h3><a href="/tuto/5.0/manual/how-to-iterate-on-all-sessions-for-one-user-or-all-tabs" class="ocsimore_phrasing_link">How to iterate on all sessions for one user, or all tabs</a></h3><h3><a href="/tuto/5.0/manual/how-to-implement-a-notification-system" class="ocsimore_phrasing_link">How to implement a notification system</a></h3><h3><a href="/tuto/5.0/manual/how-to-send-a-file-to-server-without-stopping-the-client-process" class="ocsimore_phrasing_link">How to send a file to server without stopping the client process</a></h3><h3><a href="/tuto/5.0/manual/how-to-detect-channel-disconnection" class="ocsimore_phrasing_link">How to detect channel disconnection</a></h3><h3><a href="/tuto/5.0/manual/how-to-detect-on-client-side-that-the-server-side-state-for-the-process-is-closed" class="ocsimore_phrasing_link">How to detect on client side that the server side state for the process is closed</a></h3><h2> Database</h2><h3><a href="/tuto/5.0/manual/how-to-use-a-database-with-eliom" class="ocsimore_phrasing_link">How to use a database with Eliom</a></h3><h2> Eliom Server side</h2><h3><a href="/tuto/5.0/manual/how-do-i-create-a-cryptographically-safe-identifier" class="ocsimore_phrasing_link">How do I create a Cryptographically safe identifier</a></h3></nav></nav><article class="rightcol"><h1>Saving favorite pictures</h1><aside class="concepts"><header><h5>Concepts</h5></header><p>Atom feed</p></aside><p>We will now add a button to the Graffiti application to save the current
image. The images will be saved to the filesystem using the module
<span><a class="ocsforge_doclink_lwt" href="/lwt/3.3.0/api/Lwt_io">Lwt_io</a></span>. We will then make an Atom feed
with the saved images using <span><a class="ocsforge_doclink_eliom" href="/eliom/6.3/api/server/Atom_feed">Atom_feed</a></span>.
</p><p>We save the images in the directory containing the static contents
under the directory <span class="teletype">images_saved/username</span>. The <span class="teletype">username</span>
directory is created if needed. If it already exists <span class="teletype">mkdir</span> fails
and we do nothing.
</p><p>We will add this code in a new file:
</p><h4><span class="teletype">feed.ml</span></h4><pre class=""><code class="language-ocaml translatable">open Eliom_content.Html5.D

let static_dir = &quot;/tmp/static/&quot;

let image_dir name =
  let dir = static_dir ^ &quot;/graffiti_saved/&quot; ^ (Url.encode name) in
  (try%lwt Lwt_unix.mkdir dir 511 with
    | _ -&gt; debug &quot;could not create the directory %s&quot; dir; Lwt.return ())
  &gt;|= (fun () -&gt; dir)

let make_filename name number =
  image_dir name &gt;|= fun dir -&gt;
  dir ^ &quot;/&quot; ^ (string_of_int number) ^ &quot;.png&quot;

let save image name number =
  let%lwt file_name = make_filename name number in
  let%lwt out_chan = Lwt_io.open_file ~mode:Lwt_io.output file_name in
  Lwt_io.write out_chan image</code></pre><p>We number images and associate to each image the time of creation. It
is stocked in an <span><a class="ocsforge_doclink_eliom" href="/eliom/6.3/api/server/Ocsipersist">Ocsipersist</a></span>
table.
</p><pre class=""><code class="language-ocaml translatable">let image_info_table = Ocsipersist.open_table &quot;image_info_table&quot;</code></pre><p>For each user, we stock a value of type<br/>
<span class="teletype"> int * CalendarLib.Calendar.t * ((int * CalendarLib.Calendar.t) list)</span>.
The first integer is the name under which will be saved the image, the first
time is the last update for that user and the list contains the names and
times of old images. We need those times to timestamp the entries of the feed.
</p><pre class=""><code class="language-ocaml translatable">let save_image username =
  let now = CalendarLib.Calendar.now () in
  let%lwt number,_,list =
    try%lwt Ocsipersist.find image_info_table username with
      | Not_found -&gt; Lwt.return (0,now,[])
      | e -&gt; Lwt.fail e
  in
  let%lwt () = Ocsipersist.add image_info_table
    username (number+1,now,(number,now)::list) in
  let (_,image_string) = Hashtbl.find graffiti_info username in
  save (image_string ()) username number

let save_image_box name =
  let save_image_service =
    Eliom_registration.Action.register_post_coservice'
      ~post_params:Eliom_parameter.unit
      (fun () () -&gt; save_image name)
  in
  Form.post_form save_image_service
    (fun _ -&gt;
      [p [Form.input ~input_type:`Submit ~value:&quot;save&quot; Form.string]]) ()</code></pre><p>We find the url of the images with <span><a class="ocsforge_doclink_eliom" href="/eliom/6.3/api/server/Eliom_service#VALstatic_dir">Eliom_service.​static_dir</a></span>.  It is a service
taking file path as parameter, serving the content of the static
directory. We use <span><a class="ocsforge_doclink_eliom" href="/eliom/6.3/api/server/Eliom_uri#VALmake_string_uri">Eliom_uri.​make_string_uri</a></span> to get the url as a string.
</p><pre class=""><code class="language-ocaml translatable">let feed_service = Eliom_service.Http.service ~path:[&quot;feed&quot;]
  ~get_params:(Eliom_parameter.string &quot;name&quot;) ()

let local_filename name number =
  [&quot;graffiti_saved&quot;; Url.encode name ; (string_of_int number) ^ &quot;.png&quot;]

let rec entries name list = function
  | 0 -&gt; []
  | len -&gt;
    match list with
      | [] -&gt; []
      | (n,saved)::q -&gt;
	let title = Atom_feed.plain
	  (&quot;graffiti &quot; ^ name ^ &quot; &quot; ^ (string_of_int n)) in
	let uri =
	  make_string_uri ~absolute:true
	    ~service:(Eliom_service.static_dir ())
	    (local_filename name n)
	in
	let entry =
	  Atom_feed.entry ~title ~id:uri ~updated:saved
            [Atom_feed.html5C [ img ~src:uri ~alt:&quot;image&quot; ()]] in
	entry::(entries name q (len - 1))

let feed name () =
  let id = make_string_uri
    ~absolute:true
    ~service:feed_service name in
  let title = Atom_feed.plain (&quot;nice drawings of &quot; ^ name) in
  Lwt.catch
    (fun () -&gt; Ocsipersist.find image_info_table name &gt;|=
	(fun (number,updated,list) -&gt;
	  Atom_feed.feed ~id ~updated ~title (entries name list 10)))
    ( function Not_found -&gt;
      let now = CalendarLib.Calendar.now () in
      Lwt.return (Atom_feed.feed ~id ~updated:now ~title [])
      | e -&gt; Lwt.fail e )

let () = Eliom_atom.Reg.register ~service:feed_service feed</code></pre><p>And then use the new module as follow:
</p><pre class=""><code class="language-ocaml translatable">[ a Feed.feed_service [pcdata &quot;atom feed&quot;] name;
    div (if name = username
      then [Feed.save_image_box name]
      else [pcdata &quot;no saving&quot;]);
  ]</code></pre></article></div></div></body></html>
